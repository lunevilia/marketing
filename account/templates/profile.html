{% extends 'accountlayout/profilelayer.html' %}
{% block name %}
<script>
function modify_profile() {
  var r = confirm("ìˆ˜ì •ëœ ì •ë³´ë¡œ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
  if (r == true) {
    return true;
  } else {
    return false;
  }
}

function delete_profile() {
    var r = prompt("ì •ë§ë¡œ ì•„ì´ë””ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œë¥¼ ì›í•˜ë©´ \"ì‚­ì œ\"ë¥¼ ì…ë ¥í•˜ê³  í™•ì¸ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!\n(ì‚­ì œí•˜ë©´ ë³µêµ¬ëŠ” ë¶ˆê°€ëŠ¥ğŸš« í•©ë‹ˆë‹¤!)");
    if (r == "ì‚­ì œ") {
        location.href = "{% url 'account:del_user' %}";
        alert("ê·¸ ë™ì•ˆ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤!");
    } else {
        return;
    }
}

function rematch(x){
    var nickname_check;
    if (x=="nickname_id") {
        nickname_check = false
        $('#modify_check').css("display", "block");
        $('#nickname_check').text("ì¤‘ë³µëœ í™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
        $('#nickname_check').css("color", "red");
    }
    $('#modify_submit').attr("disabled", true);
    $('#overlap_id').text("ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
}

function modify_overlap(x, region){
    $.ajax({
        // typeì„ ì„¤ì •í•©ë‹ˆë‹¤.
        type : 'GET',
        url : "{% url 'account:ajax' 'abc' 'region' %}".replace(/abc/, x.toString()).replace(/region/, region.toString()),
        success : function (data) {
            // ë§Œì•½ ì£¼ëŠ” ë…€ì„ì´ regionì— ë”°ë¥¸ ë…€ì„ì´ë©´ regionì— ë”°ë¥¸ ë…€ì„ë§Œ ë³€ê²½
            if(data["check"]){
                if (region == "nickname"){
                    $('#nickname_check').text("ì¤‘ë³µëœ ë‹‰ë„¤ì„ì´ ì¡´ì¬í•©ë‹ˆë‹¤");
                    $('#nickname_check').css("color", "red");
                    nickname_check = false;
                }
            } else {
                if  (region == "nickname"){
                    $('#nickname_check').text("ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤");
                    $('#nickname_check').css("color", "blue");
                    nickname_check = true;
                }
            }
        },
        error: function () { 
            if (region == "nickname"){
                $('#nickname_check').text("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
                nickname_check = false;
            }
        },
        complete: function() {
            if (nickname_check){
                $('#modify_submit').attr("disabled", false);
            } else {
                $('#modify_submit').attr("disabled", true);
                $('#overlap_id').text("ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
            }
        }
    });
    }

</script>
<div class="card bg-light mb-3" style="width:fit-content;margin:auto;padding: 20px;">
    <div style="text-align: center;" class="card-header"><h4>íšŒì›ì •ë³´</h4></div>
    <div class="card-body">
        <div style="text-align: center;">
        <h4>í”„ë¡œí•„ ì‚¬ì§„</h4>
        <p>{% if user.profile.Image %}<img alt="{{user.profile.Name}}" width="100" height="100" src="{{user.profile.Image.url}}">{% else %}ì„¤ì •í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!{% endif %}</p>
        </div>
        <table style="margin:auto;">
            <tr>
                <td><b>ë‹‰ë„¤ì„ &nbsp;&nbsp; </b></td><td style="text-align: center;">{{user.profile.Name}}</td>
            </tr>
            <tr>
                <td><b>ì´ë©”ì¼ &nbsp;&nbsp; </b></td><td>{{user.profile.Email}}</td>
            </tr>
        </table>
        <p></p>
        <div style="text-align: center;">
            <p><a href="{% url 'account:donotalert_board' %}">ì•Œë¦¼ì„¤ì •</a></p>
            <p><a href="{% url 'account:like_board' %}">ì¢‹ì•„ìš”í•œ ê²Œì‹œíŒ</a></p>
            <p><a href="{% url 'account:favorite_board' %}">ì¦ê²¨ì°¾ê¸°</a></p>
            <p><a href="{% url 'account:alert_board' %}">ì•Œë¦¼ë‚´ìš©</a></p>
            <p><a style="color: red;cursor:pointer;" onclick="delete_profile()">íšŒì›íƒˆí‡´</a></p>
            {% if user.is_superuser %}
            <p><a href="{% url 'account:important_board' %}">ì¤‘ìš”ê²Œì‹œíŒ ì„¤ì •</a></p>
            {% endif %}
        </div>
    </div>
    <div style="text-align: center;" class="card-footer">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">ê°œì¸ì •ë³´ ìˆ˜ì •</button>
    </div>
</div>
    
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">ì •ë³´ ìˆ˜ì •</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <form onSubmit="return modify_profile()" action="{% url 'account:profile' %}" enctype="multipart/form-data" method="post">
                {% csrf_token %}
                {{profile_form.as_p}}
                <span id="nickname_check"></span>
                <input style="display: none;" id="modify_check" type="button" onclick="modify_overlap($('#nickname_id').val(), 'nickname');" value="ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸">
        </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ì·¨ì†Œ</button>
                <button id="modify_submit" type="submit" class="btn btn-primary">ìˆ˜ì •</button>
                </div>
            </form>
      </div>
    </div>
  </div>

{% endblock %}
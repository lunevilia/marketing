{% extends 'accountlayout/signuplayer.html' %}
{% block name %}

<script>
    var username_check, nickname_check, email_check;
    
    function rematch(x){
        console.log(x)
        if(x=="username_id"){
            username_check = false
            $('#username_check').text("ì¤‘ë³µëœ í™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
            $('#username_check').css("color", "red");
        } else if (x=="nickname_id") {
            nickname_check = false
            $('#nickname_check').text("ì¤‘ë³µëœ í™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
            $('#nickname_check').css("color", "red");
        } else if (x=="email_id"){
            email_check = false
            $('#email_check').text("ì¤‘ë³µëœ í™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
            $('#email_check').css("color", "red");
        }
        $('#user_submit').attr("disabled", true);
        $('#overlap_id').text("ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
    }
    
    //ì¤‘ë³µ í™•ì¸í•˜ëŠ” ajax í•¨ìˆ˜
    function overlap(x, region){
    $.ajax({
        // typeì„ ì„¤ì •í•©ë‹ˆë‹¤.
        type : 'GET',
        url : "{% url 'account:ajax' 'abc' 'region' %}".replace(/abc/, x.toString()).replace(/region/, region.toString()),
        success : function (data) {
            // ë§Œì•½ ì£¼ëŠ” ë…€ì„ì´ regionì— ë”°ë¥¸ ë…€ì„ì´ë©´ regionì— ë”°ë¥¸ ë…€ì„ë§Œ ë³€ê²½
            if(data["check"]){
                if (region == "username"){
                    $('#username_check').text("ì¤‘ë³µëœ ì•„ì´ë””ê°€ ì¡´ì¬í•©ë‹ˆë‹¤");
                    $('#username_check').css("color", "red");
                    username_check = false;
                }
                else if (region == "nickname"){
                    $('#nickname_check').text("ì¤‘ë³µëœ ë‹‰ë„¤ì„ì´ ì¡´ì¬í•©ë‹ˆë‹¤");
                    $('#nickname_check').css("color", "red");
                    nickname_check = false;
                }
                else if (region == "email"){
                    $('#email_check').text("ì¤‘ë³µëœ ì´ë©”ì¼ì´ ì¡´ì¬í•©ë‹ˆë‹¤");
                    $('#email_check').css("color", "red");
                    email_check = false;
                }
            } else {
                if (region == "username"){
                    $('#username_check').text("ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë”” ì…ë‹ˆë‹¤");
                    $('#username_check').css("color", "blue");
                    username_check = true;
                }
                else if (region == "nickname"){
                    $('#nickname_check').text("ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤");
                    $('#nickname_check').css("color", "blue");
                    nickname_check = true;
                }
                else if (region == "email"){
                    $('#email_check').text("ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ ì…ë‹ˆë‹¤");
                    $('#email_check').css("color", "blue");
                    email_check = true;
                }
            }
        },
        error: function () { 
            if (region == "username"){
                $('#username_check').text("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
                username_check = false;
            }
            else if (region == "nickname"){
                $('#nickname_check').text("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
                nickname_check = false;
            }
            else if (region == "email"){
                $('#email_check').text("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
                email_check = false;
            }
        },
        complete: function() {
            if (username_check && nickname_check && email_check){
                $('#user_submit').attr("disabled", false);
                $('#overlap_id').text("íšŒì›ê°€ì… ê°€ëŠ¥í•©ë‹ˆë‹¤!");
            } else {
                $('#user_submit').attr("disabled", true);
                $('#overlap_id').text("ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
            }
        }
    });
    }

window.onload = function(){
    //Check File API support
    if(window.File && window.FileList && window.FileReader)
    {
        var ImageInput = document.getElementById("id_Image");
        var image_set = document.getElementById("image_set")
        ImageInput.addEventListener("change", function(event){
            var files = event.target.files; //FileList object
            if(files.length){
                image_set.innerHTML = "ì‚¬ì§„ ì„¤ì • ì™„ë£Œ"
            } else {
                image_set.innerHTML = ""
            }
        });
    }
}

</script>
<style>
th {
    text-align: right;
}

tr, td {
    text-align: center;
}
</style>
<div class="card bg-light mb-3">
    <div style="text-align: center;" class="card-header"><h4>READLY</h4></div>
    <div class="card-body">
        <form enctype="multipart/form-data" action="{% url 'account:signup' %}" method="post">
            {% csrf_token %}
            <table style="margin:auto; margin-bottom: 10px;width: 100%;">
                <tr>
                    <td><input style="text-align: center;" id="username_id" name="username_id" type="text" placeholder="ğŸ‘¤ì•„ì´ë””" onchange="rematch(this.id)" required></td>
                </tr>
                <tr>
                    <td><input class="btn btn-warning btn-sm" type="button" value="ì•„ì´ë”” ì¤‘ë³µí™•ì¸" onclick="overlap($('#username_id').val(), 'username');"></span></td>
                </tr>
                <tr>
                    <td><span id="username_check"></span></td>
                </tr>
                <tr>
                    <td><input style="text-align: center;" name="password1" type="password" placeholder="ğŸ”’ë¹„ë°€ë²ˆí˜¸" required></td>
                </tr>
                <tr>
                    <td><input style="text-align: center;" name="password2" type="password" placeholder="ğŸ”’ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required></td>
                </tr>
                <tr>
                    <td>{{ form.Name }}</td>
                </tr>
                <tr>
                    <td><input class="btn btn-warning btn-sm" type="button" value="ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸" onclick="overlap($('#nickname_id').val(), 'nickname');"></td>
                </tr>
                <tr>
                    <td><span id="nickname_check"></span></td>
                </tr>
                <tr>
                    <td>{{ form.Image }}</td>
                </tr>
                <tr>
                    <td>{{ form.Email }}</td>
                </tr>
                <tr>
                    <td><input class="btn btn-warning btn-sm" type="button" value="ì´ë©”ì¼ ì¤‘ë³µí™•ì¸" onclick="overlap($('#email_id').val(), 'email');"></td>
                </tr>
                <tr>
                    <td><span id="email_check"></span></td>
                </tr>
                <tr>
                    <td><input class="btn btn-info btn-sm" style="margin-top:5px;" type="button" value="ğŸ–¼í”„ë¡œí•„ì‚¬ì§„(ì„ íƒì‚¬í•­)" onclick="document.getElementById('id_Image').click();" /></td>
                </tr>
                <tr>
                    <td><div style="color: blue; margin-bottom: 10px;" id="image_set"></div></td>
                </tr>
                <tr>
                    <td><input class="btn btn-primary btn-sm" id="user_submit" type="submit" value="ê°€ì…í•˜ê¸°" disabled><br><span id="overlap_id">ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”!</span></td>
                </tr>
                <tr>
                    <td><span style="color:red;">{{error}}</span></td>
                </tr>
                {% if messages %}
                <tr>
                    <td>
                    <div style="text-align: center;color:red;">
                        {% for message in messages %}
                        {{ message }}
                        {% endfor %}
                    </div>
                    </td>
                </tr>
                {% endif %}
            </table>    
        </form>
    </div>
</div>



{% endblock %}